#!/bin/bash

set -e

SCRIPT_DIR=$(dirname "${BASH_SOURCE[0]}")
BASE_DIR=$(realpath "${SCRIPT_DIR}/..")


docker buildx build \
    --build-arg USER_UID=$(id -u) \
    --build-arg USER_NAME=$(id -u -n) \
    --load \
    -t canvas-runner \
    -f ./docker/deployment/Containerfile \
    .

docker run \
    --name canvas \
    --detach \
    -p 8083:8083/tcp \
    --volume ${BASE_DIR}/:/code \
    canvas-runner \
    ./bin/canvasctl run webserver \
