#!/bin/bash

set -e

SCRIPT_DIR=$(dirname "${BASH_SOURCE[0]}")
BASE_DIR=$(realpath "${SCRIPT_DIR}/..")


docker buildx build \
    --build-arg USER_UID=$(id -u) \
    --build-arg USER_NAME=$(id -u -n) \
    --load \
    -t canvas-integration-test-runner \
    -f ./docker/integration-test-runner/Containerfile \
    .

docker run \
    --rm \
    --network canvas-integration_default \
    --volume .:/code \
    canvas-integration-test-runner \
    make alltests
